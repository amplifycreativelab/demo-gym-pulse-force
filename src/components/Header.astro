---
import ChargeButton from "./ChargeButton.astro";

const base = import.meta.env.BASE_URL.endsWith("/")
    ? import.meta.env.BASE_URL
    : `${import.meta.env.BASE_URL}/`;

const navLinks = [
    { name: "Programs", href: `${base}programs` },
    { name: "Classes", href: `${base}classes` },
    { name: "Trainers", href: `${base}trainers` },
    { name: "Pricing", href: `${base}pricing` },
    { name: "About", href: `${base}about` },
];
---

<header
    class="fixed top-0 left-0 w-full z-50 glass-dark border-b border-white/5"
>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-20">
            <!-- Logo -->
            <a href={base} class="flex items-center gap-2">
                <div
                    class="w-8 h-8 md:w-10 md:h-10 bg-volt rounded-sm flex items-center justify-center"
                >
                    <svg
                        class="w-5 h-5 md:w-6 md:h-6 text-void"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2.5"
                            d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
                <span
                    class="font-heading font-black text-lg md:text-2xl tracking-tighter uppercase"
                >
                    Pulse<span class="text-volt">Forge</span>
                </span>
            </a>

            <!-- Desktop Nav -->
            <nav class="hidden md:flex items-center gap-8">
                {
                    navLinks.map((link) => (
                        <a
                            href={link.href}
                            class="text-sm font-medium uppercase tracking-widest text-muted hover:text-white transition-colors"
                        >
                            {link.name}
                        </a>
                    ))
                }
            </nav>

            <!-- Right Side Actions -->
            <div class="flex items-center gap-2 sm:gap-4">
                <a
                    href={`${base}contact`}
                    class="hidden sm:block text-sm font-medium uppercase tracking-widest text-muted hover:text-white transition-colors"
                >
                    Contact
                </a>
                <ChargeButton
                    href={`${base}contact`}
                    class="!px-2.5 !py-1.5 !text-xs sm:!px-8 sm:!py-3 sm:!text-sm whitespace-nowrap"
                >
                    Start Free Trial
                </ChargeButton>

                <!-- Mobile Menu Toggle -->
                <button
                    id="mobile-menu-toggle"
                    class="md:hidden text-white p-1 z-50 relative"
                    aria-label="Toggle menu"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path
                            id="menu-icon"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 6h16M4 12h16m-7 6h7"></path>
                        <path
                            id="close-icon"
                            class="hidden"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Mobile Menu Overlay -->
    <div
        id="mobile-menu"
        class="fixed inset-0 bg-void/95 backdrop-blur-2xl z-40 translate-x-full transition-transform duration-500 ease-expo pointer-events-none md:hidden"
    >
        <div
            class="flex flex-col items-center justify-start pt-32 pb-12 h-full gap-6 overflow-y-auto"
        >
            {
                navLinks.map((link) => (
                    <a
                        href={link.href}
                        class="text-2xl font-heading font-black uppercase tracking-tighter text-white hover:text-volt transition-colors"
                    >
                        {link.name}
                    </a>
                ))
            }
            <ChargeButton
                href={`${base}contact`}
                class="mt-4 px-10 py-4 text-lg"
            >
                Get Your Free Pass
            </ChargeButton>
        </div>
    </div>
</header>

<script>
    function setupMobileMenu() {
        const toggle = document.getElementById("mobile-menu-toggle");
        const menu = document.getElementById("mobile-menu");
        const menuIcon = document.getElementById("menu-icon");
        const closeIcon = document.getElementById("close-icon");
        const body = document.body;

        if (!toggle || !menu) return;

        toggle.addEventListener("click", () => {
            const isOpen = menu.classList.contains("translate-x-0");

            if (isOpen) {
                menu.classList.remove("translate-x-0");
                menu.classList.add("translate-x-full");
                menu.classList.add("pointer-events-none");
                menuIcon?.classList.remove("hidden");
                closeIcon?.classList.add("hidden");
                body.style.overflow = "";
            } else {
                menu.classList.remove("translate-x-full");
                menu.classList.add("translate-x-0");
                menu.classList.remove("pointer-events-none");
                menuIcon?.classList.add("hidden");
                closeIcon?.classList.remove("hidden");
                body.style.overflow = "hidden";
            }
        });

        // Close on link click
        menu.querySelectorAll("a").forEach((link) => {
            link.addEventListener("click", () => {
                menu.classList.add("translate-x-full");
                menu.classList.remove("translate-x-0");
                menu.classList.add("pointer-events-none");
                menuIcon?.classList.remove("hidden");
                closeIcon?.classList.add("hidden");
                body.style.overflow = "";
            });
        });
    }

    // Initialize on page load and after swaps
    setupMobileMenu();
    document.addEventListener("astro:after-swap", setupMobileMenu);
</script>

<style>
    .ease-expo {
        transition-timing-function: cubic-bezier(0.19, 1, 0.22, 1);
    }
</style>
